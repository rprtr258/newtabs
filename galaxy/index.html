<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PocketGalaxyJs</title>
  <style>
    .info {
      background-color: lightsteelblue;
      width: max-content;
      border: none;
    }
  </style>
</head>
<body style="height: 100vh; overflow: hidden; margin: 0; background-color: black;">
  <canvas style="width: 100%; height: 100%;"></canvas>
  <script>
    const canvas = document.querySelector("canvas");
    const context = canvas.getContext("2d", {willReadFrequently: true});

    // consts
    const FADE_VALUE = 20;
    const EXPECTED_FPS = 60;
    const SPEED = 0.0003;

    function resize() {
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
    }
    addEventListener("resize", resize);
    resize(); // initial resize

    function frac(value) {
      return value - Math.floor(value);
    }

    function getRandomColor() {
      function getRandomInt(max) {
        // return max;
        return frac(time * max / 90)*255;
      }
      return [
        frac(-0.1+0.150) * 255,
        frac(-0.1+0.140) * 255,
        frac(-0.1+0.256) * 255,
      ];
    }

    let time = Math.atan(Math.PI * (Math.random()-0.5));
    let realFps = 0;

    function render(data, WIDTH, HEIGHT) {
      // fade
      for (let i = 0; i < data.length; i += 4) {
        data[i + 0] = Math.max(0, data[i + 0] - FADE_VALUE); // R
        data[i + 1] = Math.max(0, data[i + 1] - FADE_VALUE); // G
        data[i + 2] = Math.max(0, data[i + 2] - FADE_VALUE); // B
        data[i + 3] = 255; // A
      }

      // draw
      const N2 = 25;
      for (let i = 1; i <= N2 * N2; i++) {
        const newPixel = getRandomColor();

        // let [x, y] = [Math.floor(i/N2)/N2, (i%N2)/N2];
        let [x, y] = [Math.random(), Math.random()];
        for (let j = 0; j < 100; j++) {
          x = frac(time + x + Math.cos(y * 2.2 + x * 0.1));
          y = frac(time * 0.3 + y + Math.sin(x * 1.5));

          const screenX = Math.trunc(x * WIDTH);
          const screenY = Math.trunc(y * HEIGHT);
          const index = (WIDTH * screenY + screenX) * 4;
          data[index + 0] = data[index + 0] + newPixel[0]; // R
          data[index + 1] = data[index + 1] + newPixel[1]; // G
          data[index + 2] = data[index + 2] + newPixel[2]; // B
        }
      }
      for (let i = 0; i < data.length; i += 4) {
        data[i + 0] = Math.min(255, data[i + 0]); // R
        data[i + 1] = Math.min(255, data[i + 1]); // G
        data[i + 2] = Math.min(255, data[i + 2]); // B
      }
    }

    function draw() {
      const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
      render(imageData.data, canvas.width, canvas.height);
      context.putImageData(imageData, 0, 0);

      time += SPEED;
      realFps++;
    }
    setInterval(draw, 1000 / EXPECTED_FPS);
  </script>
</body>
</html>
